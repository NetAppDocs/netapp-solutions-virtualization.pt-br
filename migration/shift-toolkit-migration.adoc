---
sidebar: sidebar 
permalink: migration/shift-toolkit-migration.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary: Utilize o Shift Toolkit para migrar máquinas virtuais entre plataformas de virtualização.  O processo envolve a preparação das máquinas virtuais, a conversão dos formatos de disco e a configuração das definições de rede no ambiente de destino. 
---
= Migrar VMs usando o Shift Toolkit
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Utilize o Shift Toolkit para migrar máquinas virtuais entre plataformas de virtualização.  O processo envolve a preparação das máquinas virtuais, a conversão dos formatos de disco e a configuração das definições de rede no ambiente de destino.



== Migrações suportadas

O Shift Toolkit oferece flexibilidade em ambientes com múltiplos hipervisores, suportando a migração bidirecional entre os seguintes hipervisores:

* link:shift-toolkit-migrate-esxi2hyperv.html["VMware ESXi para Microsoft Hyper-V"]
* link:shift-toolkit-migrate-hyperv2esxi.html["Microsoft Hyper-V para VMware ESXi"]
* link:shift-toolkit-migrate-esxi2olvm.html["VMware ESXi para Oracle Linux Virtualization Manager (OLVM)"]
* link:shift-toolkit-migrate-esxi2osv.html["Virtualização de VMware ESXi para Red Hat OpenShift"]




== Fluxo de trabalho de migração

Após criar um plano, você pode iniciar o processo de migração.  Durante a migração, o Shift Toolkit executa uma série de etapas para converter formatos de disco e criar máquinas virtuais no host de destino, conforme definido no plano.

O Shift Toolkit executa os seguintes passos durante a migração:

. Excluir snapshots existentes para todas as VMs no blueprint
. Acione snapshots de VM para o blueprint na origem
. Captura instantânea do volume de gatilho antes da conversão do disco
. Clonar e converter VMDK para o formato VHDx para todas as VMs
. Ligue as VMs no grupo de proteção no destino.
. Registre as redes em cada VM
. Remova o VMware Tools e atribua endereços IP usando scripts de gatilho ou tarefas cron, dependendo do tipo de sistema operacional.




== Dicas e considerações sobre redes

Ao planejar sua migração, leve em consideração os seguintes requisitos e comportamentos de rede.  O Shift Toolkit copia automaticamente as configurações de rede das VMs de origem e as reaplica às VMs migradas, mas a nomenclatura das interfaces e as configurações dos adaptadores de rede podem variar entre os sistemas Windows e Linux.

.Requisito geral
* Certifique-se de que os endereços IP estáticos estejam disponíveis e não estejam atribuídos a outra máquina virtual.


.Máquinas Virtuais do Windows
* O script de preparação copia os detalhes da configuração de rede (espaço de endereços IP, endereço do gateway, servidores DNS).
* O script de gatilho reaplica as configurações de rede durante a migração para uma ou várias NICs com base no mapeamento do blueprint.
* Após a migração, o Gerenciador de Dispositivos do Windows pode exibir informações antigas do adaptador de rede, referentes ao período anterior à migração, o que não afeta o novo adaptador nem causa conflitos de IP.
* Atualize para a versão 4.0 para remover automaticamente dispositivos de rede órfãos do registro e do Gerenciador de Dispositivos.


.Máquinas virtuais Linux
* O script de preparação copia os detalhes da configuração de rede (espaço de endereços IP, rotas, servidores DNS, nomes de dispositivos de rede).
* O script identifica o tipo de rede da distribuição Linux e aplica as configurações de IP de acordo.
* O script de reatribuição de rede está configurado como uma tarefa cron usando o crontab e é executado na inicialização do sistema.
* O script reaplica as configurações de rede para uma ou várias placas de rede com base no mapeamento do blueprint.


.Nomenclatura de interface
* As VMs convertidas podem ter nomes de interface como `eth0` ou `ensp0` em vez dos nomes das interfaces de origem (por exemplo, `ens192` ou `ens33` )
* O script atualiza os detalhes da configuração de rede para corresponder aos novos nomes de interface.
* Se forem usados nomes previsíveis com regras de correspondência udev adequadas e o nome da interface for mantido no hipervisor de destino, o script ignora a configuração de rede, remove o VMware Tools e reinicia a máquina virtual.



NOTE: O Shift Toolkit permite substituir a preparação da rede, possibilitando que os administradores executem scripts personalizados para atribuição de IP ou outras configurações.

.Mecanismos de rede suportados
* Gerenciador de Rede
* Netplan
* ifconfig
* malvado


O Shift Toolkit retém os endereços IP conforme especificado no projeto.



== Fases de migração

A seguir, apresentamos as fases de migração que você seguirá para migrar máquinas virtuais usando o Shift Toolkit.

. *Preparar VM*: Prepare as VMs para migração e verifique se todos os pré-requisitos foram atendidos.
. *Migrar e validar*: Após a conclusão da preparação, migre as VMs do VMware para o hipervisor de destino.
+
Após a conclusão da migração, verifique se as máquinas virtuais inicializaram corretamente e se os dados foram migrados adequadamente.

. *Testar a migração*: O teste de migração simula a migração convertendo o VMDK para o formato apropriado e criando VMs usando o arquivo de disco virtual convertido na qtree.
+
A migração de teste não inclui a configuração do mapeamento de rede, que deve ser realizada manualmente em uma rede de teste.




NOTE: O Shift Toolkit não altera a máquina virtual de origem, exceto pela cópia de scripts necessários para a preparação da máquina virtual.  Isso permite um rápido retorno ao estado anterior em caso de falhas na conversão.



== Executar uma migração

Para iniciar o fluxo de trabalho de migração com a configuração especificada no modelo, clique em *Migrar*.

image::shift-toolkit-030.png[Diálogo mostrando como acionar uma migração de máquina virtual.]

Uma vez iniciado, o fluxo de trabalho é ativado e o processo de conversão segue os passos descritos para registrar a VM.  Se as máquinas virtuais dentro do projeto não estiverem desligadas, o Shift Toolkit solicitará um desligamento correto antes de prosseguir.

image::shift-toolkit-031.png[Confirmação do processo de migração]


NOTE: A NetApp recomenda não acionar mais de dez conversões em paralelo, da mesma origem para o mesmo destino.

image::shift-toolkit-032.png[Progresso da migração]

A conversão de VMDK para qualquer formato de arquivo é concluída em segundos, tornando esta a opção mais rápida disponível.  Essa abordagem ajuda a reduzir o tempo de inatividade das máquinas virtuais durante a migração.

image::shift-toolkit-033.png[Progresso da conversão do disco]

Assim que a tarefa for concluída, o status do projeto mudará para "Migração Concluída".

image::shift-toolkit-034.png[Status da migração concluída]
