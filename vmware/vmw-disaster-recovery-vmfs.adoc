---
sidebar: sidebar 
permalink: vmware/vmw-disaster-recovery-vmfs.html 
keywords: dr, draas, bluexp, disaster recovery, vmfs datastore 
summary: Esta seção do documento descreve a configuração do BlueXP DRaaS para configurar a recuperação de desastres de VMs VMware locais para outro site designado. 
---
= Configurar recuperação de desastres para datastores VMFS usando a BlueXP disaster recovery
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Neste caso de uso, descrevemos o procedimento para configurar a recuperação de desastres usando a BlueXP disaster recovery para VMs VMware locais usando armazenamentos de dados do VMware Virtual Machine File System (VMFS).  Este procedimento inclui a configuração da conta e do conector BlueXP , o estabelecimento da replicação do SnapMirror entre os sistemas ONTAP , a integração com o VMware vCenter e a automatização das operações de failover e failback.

A recuperação de desastres usando replicação em nível de bloco do site de produção para o site de recuperação de desastres é uma maneira resiliente e econômica de proteger as cargas de trabalho contra interrupções do site e eventos de corrupção de dados, como ataques de ransomware. Com a replicação do NetApp SnapMirror , as cargas de trabalho do VMware em execução em sistemas ONTAP locais usando o repositório de dados VMFS podem ser replicadas para outro sistema de armazenamento ONTAP em um datacenter de recuperação designado onde o VMware reside.



== Introdução

Esta seção do documento descreve a configuração do BlueXP DRaaS para configurar a recuperação de desastres de VMs VMware locais para outro site designado. Como parte dessa configuração, a conta BlueXP , o conector BlueXP e os arrays ONTAP adicionados ao espaço de trabalho BlueXP são necessários para permitir a comunicação do VMware vCenter com o armazenamento ONTAP . Além disso, este documento detalha como configurar a replicação entre sites e como configurar e testar um plano de recuperação. A última seção contém instruções para executar um failover completo do site e como fazer failback quando o site principal é recuperado e comprado on-line.

Usando o serviço de BlueXP disaster recovery , que é integrado ao console NetApp BlueXP , os clientes podem descobrir seus VMware vCenters locais junto com o armazenamento ONTAP , criar agrupamentos de recursos, criar um plano de recuperação de desastres, associá-lo a grupos de recursos e testar ou executar failover e failback. O SnapMirror fornece replicação de bloco em nível de armazenamento para manter os dois sites atualizados com alterações incrementais, resultando em um RPO de até 5 minutos. Também é possível simular procedimentos de DR como um exercício regular sem impactar a produção e os armazenamentos de dados replicados ou incorrer em custos adicionais de armazenamento. A BlueXP disaster recovery aproveita a tecnologia FlexClone da ONTAP para criar uma cópia com eficiência de espaço do armazenamento de dados VMFS a partir do último Snapshot replicado no site de DR. Após a conclusão do teste de DR, os clientes podem simplesmente excluir o ambiente de teste, novamente sem qualquer impacto nos recursos de produção replicados reais. Quando houver necessidade (planejada ou não) de failover real, com apenas alguns cliques, o serviço de BlueXP disaster recovery orquestrará todas as etapas necessárias para colocar automaticamente as máquinas virtuais protegidas no site de recuperação de desastres designado. O serviço também reverterá o relacionamento do SnapMirror com o site principal e replicará quaisquer alterações do secundário para o primário para uma operação de failback, quando necessário. Tudo isso pode ser alcançado com uma fração do custo em comparação a outras alternativas bem conhecidas.

image:dr-draas-vmfs-030.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]



== Começando

Para começar a BlueXP disaster recovery, use o console do BlueXP e acesse o serviço.

. Faça login no BlueXP.
. Na navegação à esquerda do BlueXP , selecione Proteção > Recuperação de desastres.
. O painel de BlueXP disaster recovery é exibido.


image:dr-draas-vmfs-001.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Antes de configurar o plano de recuperação de desastres, certifique-se de que os seguintes pré-requisitos sejam atendidos:

* O BlueXP Connector é configurado no NetApp BlueXP. O conector deve ser implantado no AWS VPC.
* A instância do conector BlueXP tem conectividade com os sistemas de armazenamento e vCenter de origem e destino.
* Os sistemas de armazenamento NetApp locais que hospedam datastores VMFS para VMware são adicionados no BlueXP.
* A resolução de DNS deve estar em vigor ao usar nomes DNS. Caso contrário, use endereços IP para o vCenter.
* A replicação do SnapMirror é configurada para os volumes de armazenamento de dados baseados em VMFS designados.


Depois que a conectividade for estabelecida entre os sites de origem e destino, prossiga com as etapas de configuração, que devem levar de 3 a 5 minutos.


NOTE: A NetApp recomenda implantar o conector BlueXP no site de recuperação de desastres ou em um terceiro site, para que o conector BlueXP possa se comunicar pela rede com recursos de origem e destino durante interrupções reais ou desastres naturais.

image:dr-draas-vmfs-002.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]


NOTE: O suporte para datastores VMFS locais para locais está em fase de pré-visualização de tecnologia no momento da redação deste documento. O recurso é suportado por armazenamentos de dados VMFS baseados nos protocolos FC e ISCSI.



== Configuração de BlueXP disaster recovery

O primeiro passo na preparação para a recuperação de desastres é descobrir e adicionar os recursos de armazenamento e vCenter locais à BlueXP disaster recovery.


NOTE: Garanta que os sistemas de armazenamento ONTAP sejam adicionados ao ambiente de trabalho dentro do canvas. Abra o console BlueXP e selecione *Proteção > Recuperação de desastres* na navegação à esquerda. Selecione *Descobrir servidores vCenter* ou use o menu superior, selecione *Sites > Adicionar > Adicionar vCenter*.

image:dr-draas-vmfs-003.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Adicione as seguintes plataformas:

* *Fonte*. vCenter local.


image:dr-draas-vmfs-004.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

* *Destino*. VMC SDDC vCenter.


image:dr-draas-vmfs-005.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Depois que os vCenters são adicionados, a descoberta automatizada é acionada.



== Configurando a replicação de armazenamento entre o site de origem e o de destino

O SnapMirror usa snapshots ONTAP para gerenciar a transferência de dados de um local para outro. Inicialmente, uma cópia completa baseada em um instantâneo do volume de origem é copiada para o destino para executar uma sincronização de linha de base. À medida que ocorrem alterações de dados na origem, um novo instantâneo é criado e comparado ao instantâneo de base. Os blocos que foram alterados são então replicados para o destino, com o instantâneo mais recente se tornando a linha de base atual ou o instantâneo comum mais recente. Isso permite que o processo seja repetido e atualizações incrementais sejam enviadas ao destino.

Quando um relacionamento SnapMirror é estabelecido, o volume de destino fica em um estado somente leitura online e, portanto, ainda está acessível. O SnapMirror funciona com blocos físicos de armazenamento, em vez de em um arquivo ou outro nível lógico. Isso significa que o volume de destino é uma réplica idêntica da origem, incluindo instantâneos, configurações de volume, etc. Se os recursos de eficiência de espaço do ONTAP , como compactação de dados e desduplicação de dados, estiverem sendo usados pelo volume de origem, o volume replicado manterá essas otimizações.

Interromper o relacionamento do SnapMirror torna o volume de destino gravável e normalmente seria usado para executar um failover quando o SnapMirror estiver sendo usado para sincronizar dados com um ambiente de DR. O SnapMirror é sofisticado o suficiente para permitir que os dados alterados no site de failover sejam ressincronizados de forma eficiente de volta ao sistema primário, caso ele volte a ficar on-line posteriormente, e então permitir que o relacionamento original do SnapMirror seja restabelecido.



== Como configurá-lo para recuperação de desastres do VMware

O processo para criar a replicação do SnapMirror permanece o mesmo para qualquer aplicativo. O processo pode ser manual ou automatizado. A maneira mais fácil é aproveitar o BlueXP para configurar a replicação do SnapMirror usando o simples recurso de arrastar e soltar do sistema ONTAP de origem no ambiente para o destino para acionar o assistente que orienta o restante do processo.

image:dr-draas-vmfs-006.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

O BlueXP DRaaS também pode automatizar o mesmo, desde que os dois critérios a seguir sejam atendidos:

* Os clusters de origem e destino têm um relacionamento de pares.
* O SVM de origem e o SVM de destino têm um relacionamento de mesmo nível.


image:dr-draas-vmfs-007.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]


NOTE: Se o relacionamento do SnapMirror já estiver configurado para o volume via CLI, o BlueXP DRaaS assume o relacionamento e continua com o restante das operações de fluxo de trabalho.


NOTE: Além das abordagens acima, a replicação do SnapMirror também pode ser criada via ONTAP CLI ou System Manager. Independentemente da abordagem usada para sincronizar os dados usando o SnapMirror, o BlueXP DRaaS orquestra o fluxo de trabalho para operações de recuperação de desastres eficientes e contínuas.



== O que a BlueXP disaster recovery pode fazer por você?

Depois que os sites de origem e destino são adicionados, a BlueXP disaster recovery executa a descoberta profunda automática e exibe as VMs junto com os metadados associados. A BlueXP disaster recovery também detecta automaticamente as redes e os grupos de portas usados pelas VMs e os preenche.

image:dr-draas-vmfs-008.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Depois que os sites forem adicionados, as VMs podem ser agrupadas em grupos de recursos. Os grupos de recursos de BlueXP disaster recovery permitem que você agrupe um conjunto de VMs dependentes em grupos lógicos que contêm suas ordens de inicialização e atrasos de inicialização que podem ser executados na recuperação. Para começar a criar grupos de recursos, navegue até *Grupos de recursos* e clique em *Criar novo grupo de recursos*.

image:dr-draas-vmfs-009.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]


NOTE: O grupo de recursos também pode ser criado durante a criação de um plano de replicação.

A ordem de inicialização das VMs pode ser definida ou modificada durante a criação de grupos de recursos usando um mecanismo simples de arrastar e soltar.

image:dr-draas-vmfs-010.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Depois que os grupos de recursos forem criados, a próxima etapa é criar o projeto de execução ou um plano para recuperar máquinas virtuais e aplicativos em caso de desastre. Conforme mencionado nos pré-requisitos, a replicação do SnapMirror pode ser configurada antecipadamente ou o DRaaS pode configurá-la usando o RPO e a contagem de retenção especificados durante a criação do plano de replicação.

image:dr-draas-vmfs-011.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

image:dr-draas-vmfs-012.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Configure o plano de replicação selecionando as plataformas vCenter de origem e destino no menu suspenso e escolha os grupos de recursos a serem incluídos no plano, juntamente com o agrupamento de como os aplicativos devem ser restaurados e ligados e o mapeamento de clusters e redes. Para definir o plano de recuperação, navegue até a guia *Plano de Replicação* e clique em *Adicionar Plano*.

Primeiro, selecione o vCenter de origem e depois selecione o vCenter de destino.

image:dr-draas-vmfs-013.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

O próximo passo é selecionar grupos de recursos existentes. Se nenhum grupo de recursos for criado, o assistente ajudará a agrupar as máquinas virtuais necessárias (basicamente, criar grupos de recursos funcionais) com base nos objetivos de recuperação. Isso também ajuda a definir a sequência de operação de como as máquinas virtuais do aplicativo devem ser restauradas.

image:dr-draas-vmfs-014.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]


NOTE: O grupo de recursos permite definir a ordem de inicialização usando a funcionalidade de arrastar e soltar. Ele pode ser usado para modificar facilmente a ordem em que as VMs serão ligadas durante o processo de recuperação.


NOTE: Cada máquina virtual dentro de um grupo de recursos é iniciada em sequência com base na ordem. Dois grupos de recursos são iniciados em paralelo.

A captura de tela abaixo mostra a opção de filtrar máquinas virtuais ou armazenamentos de dados específicos com base em requisitos organizacionais, caso os grupos de recursos não sejam criados previamente.

image:dr-draas-vmfs-015.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Depois que os grupos de recursos forem selecionados, crie os mapeamentos de failover. Nesta etapa, especifique como os recursos do ambiente de origem são mapeados para o destino. Isso inclui recursos de computação e redes virtuais. Personalização de IP, pré e pós-scripts, atrasos de inicialização, consistência de aplicativos e assim por diante. Para obter informações detalhadas, consultelink:https://docs.netapp.com/us-en/bluexp-disaster-recovery/use/drplan-create.html#map-source-resources-to-the-target["Crie um plano de replicação"] .

image:dr-draas-vmfs-016.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]


NOTE: Por padrão, os mesmos parâmetros de mapeamento são usados para operações de teste e failover. Para aplicar mapeamentos diferentes para o ambiente de teste, selecione a opção Mapeamento de teste depois de desmarcar a caixa de seleção, conforme mostrado abaixo:

image:dr-draas-vmfs-017.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Quando o mapeamento de recursos estiver concluído, clique em Avançar.

image:dr-draas-vmfs-018.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Selecione o tipo de recorrência. Em palavras simples, selecione Migrar (migração única usando failover) ou a opção de replicação contínua recorrente. Neste passo a passo, a opção Replicar está selecionada.

image:dr-draas-vmfs-019.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Uma vez concluído, revise os mapeamentos criados e clique em Adicionar plano.

image:dr-draas-vmfs-020.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

image:dr-draas-vmfs-021.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Depois que o plano de replicação for criado, o failover poderá ser executado dependendo dos requisitos, selecionando a opção failover, a opção test-failover ou a opção migrate. A BlueXP disaster recovery garante que o processo de replicação seja executado de acordo com o plano a cada 30 minutos. Durante as opções de failover e teste-failover, você pode usar a cópia mais recente do SnapMirror Snapshot ou selecionar uma cópia específica do Snapshot de uma cópia pontual do Snapshot (conforme a política de retenção do SnapMirror). A opção de momento específico pode ser muito útil se houver um evento de corrupção, como um ransomware, em que as réplicas mais recentes já estão comprometidas ou criptografadas. A BlueXP disaster recovery mostra todos os pontos de recuperação disponíveis.

image:dr-draas-vmfs-022.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Para acionar o failover ou testar o failover com a configuração especificada no plano de replicação, clique em *Failover* ou *Testar failover*.

image:dr-draas-vmfs-023.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]



== O que acontece durante uma operação de failover ou failover de teste?

Durante uma operação de failover de teste, a BlueXP disaster recovery cria um volume FlexClone no sistema de armazenamento ONTAP de destino usando a cópia mais recente do Snapshot ou um snapshot selecionado do volume de destino.


NOTE: Uma operação de failover de teste cria um volume clonado no sistema de armazenamento ONTAP de destino.


NOTE: Executar uma operação de recuperação de teste não afeta a replicação do SnapMirror .

image:dr-draas-vmfs-024.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Durante o processo, a BlueXP disaster recovery não mapeia o volume de destino original. Em vez disso, ele cria um novo volume FlexClone a partir do Snapshot selecionado e um armazenamento de dados temporário que faz o backup do volume FlexClone é mapeado para os hosts ESXi.

image:dr-draas-vmfs-025.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

image:dr-draas-vmfs-026.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Quando a operação de failover de teste for concluída, a operação de limpeza poderá ser acionada usando *"Limpar teste de failover"*. Durante esta operação, a BlueXP disaster recovery destrói o volume FlexClone que foi usado na operação.

No caso de ocorrer um desastre real, a BlueXP disaster recovery executa as seguintes etapas:

. Quebra o relacionamento SnapMirror entre os sites.
. Monta o volume do armazenamento de dados VMFS após a resignação para uso imediato.
. Registre as VMs
. Ligar VMs


image:dr-draas-vmfs-027.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Depois que o site principal estiver instalado e funcionando, a BlueXP disaster recovery habilitará a ressincronização reversa para o SnapMirror e habilitará o failback, que novamente pode ser executado com o clique de um botão.

image:dr-draas-vmfs-028.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

E se a opção de migração for escolhida, ela será considerada um evento de failover planejado. Nesse caso, uma etapa adicional é acionada, que é desligar as máquinas virtuais no site de origem. O restante das etapas permanece o mesmo do evento de failover.

No BlueXP ou no ONTAP CLI, você pode monitorar o status de integridade da replicação para os volumes de armazenamento de dados apropriados, e o status de um failover ou failover de teste pode ser rastreado por meio do Monitoramento de tarefas.

image:dr-draas-vmfs-029.png["Figura mostrando diálogo de entrada/saída ou representando conteúdo escrito"]

Isso fornece uma solução poderosa para lidar com um plano de recuperação de desastres personalizado e personalizado. O failover pode ser feito como failover planejado ou failover com o clique de um botão quando ocorre um desastre e é tomada a decisão de ativar o site de DR.

Para saber mais sobre esse processo, fique à vontade para seguir o vídeo passo a passo detalhado ou usar olink:https://netapp.github.io/bluexp-draas-vmfs-simulator/?frame-0.1["simulador de soluções"] .
