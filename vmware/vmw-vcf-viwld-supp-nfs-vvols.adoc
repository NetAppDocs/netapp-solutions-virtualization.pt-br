---
sidebar: sidebar 
permalink: vmware/vmw-vcf-viwld-supp-nfs-vvols.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, vvol, vvols, array, ontap tools, otv, sddc 
summary:  
---
= Adicione NFS e vVols como armazenamento suplementar aos domínios de carga de trabalho VI usando ONTAP tools for VMware vSphere
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Neste caso de uso, descrevemos o procedimento para usar o ONTAP Tools for VMware para adicionar datastores NFS e vVols como armazenamento suplementar para um domínio de carga de trabalho de infraestrutura virtual (VI) do VMware Cloud Foundation (VCF).  Este procedimento resume a implantação do ONTAP Tools para VMware vSphere, a configuração de uma Máquina Virtual de Armazenamento (SVM) com interfaces lógicas NFS e o provisionamento de armazenamentos de dados NFS e vVols .

*NFS* é usado como protocolo de armazenamento para o armazenamento de dados vVols .



== Benefícios do NFS

*Simplicidade e facilidade de uso:* O NFS é simples de configurar e gerenciar, o que o torna uma excelente escolha para ambientes que exigem compartilhamento de arquivos rápido e fácil.

*Escalabilidade:* a arquitetura do ONTAP permite que o NFS seja dimensionado de forma eficiente, dando suporte às crescentes necessidades de dados sem mudanças significativas na infraestrutura.

*Flexibilidade:* O NFS oferece suporte a uma ampla variedade de aplicativos e cargas de trabalho, o que o torna versátil para vários casos de uso, incluindo ambientes virtualizados.

Para mais informações, consulte o link:vmw-vvf-overview.html["Guia de referência do NFS v3 para vSphere 8"] .



== Visão geral do cenário

Este cenário abrange as seguintes etapas de alto nível:

* Crie uma máquina virtual de armazenamento (SVM) com interfaces lógicas (LIFs) para tráfego NFS.
* Crie um grupo de portas distribuídas para a rede NFS no domínio de carga de trabalho do VI.
* Crie um adaptador vmkernel para NFS nos hosts ESXi para o domínio de carga de trabalho do VI.
* Implante o ONTAP Tools no domínio de carga de trabalho do VI.
* Crie um novo armazenamento de dados NFS no domínio de carga de trabalho do VI.
* Crie um novo armazenamento de dados vVols no domínio de carga de trabalho do VI.




== Pré-requisitos

Este cenário requer os seguintes componentes e configurações:

* Um sistema de armazenamento ONTAP AFF ou FAS com portas de dados físicas em switches Ethernet dedicados ao tráfego de armazenamento.
* A implantação do domínio de gerenciamento do VCF foi concluída e o cliente vSphere está acessível.
* Um domínio de carga de trabalho VI foi implantado anteriormente.


A NetApp recomenda projetos de rede redundantes para NFS, fornecendo tolerância a falhas para sistemas de armazenamento, switches, adaptadores de rede e sistemas host.  É comum implantar o NFS com uma única sub-rede ou várias sub-redes, dependendo dos requisitos arquitetônicos.

Consulte https://www.vmware.com/docs/vmw-best-practices-running-nfs-vmware-vsphere["Melhores práticas para executar o NFS com o VMware vSphere"] para obter informações detalhadas específicas do VMware vSphere.

Para obter orientação de rede sobre o uso do ONTAP com o VMware vSphere, consulte o https://docs.netapp.com/us-en/ontap-apps-dbs/vmware/vmware-vsphere-network.html#nfs["Configuração de rede - NFS"] seção da documentação dos aplicativos empresariais da NetApp .

Esta documentação demonstra o processo de criação de um novo SVM e especificação das informações de endereço IP para criar vários LIFs para tráfego NFS.  Para adicionar novos LIFs a um SVM existente, consultelink:https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["Criar uma LIF (interface de rede)"] .

Para obter informações completas sobre o uso do NFS com clusters vSphere, consulte olink:vmw-vvf-overview.html["Guia de referência do NFS v3 para vSphere 8"] .

{nbsp}image:vmware-vcf-aff-070.png["Diagrama de arquitetura NFS"] {nbsp}



== Etapas de implantação

Para implantar o ONTAP Tools e usá-lo para criar um armazenamento de dados vVols e NFS no domínio de gerenciamento do VCF, conclua as seguintes etapas:



=== Crie SVM e LIFs no sistema de armazenamento ONTAP

A etapa seguinte é executada no ONTAP System Manager.

.Crie a VM de armazenamento e os LIFs
[%collapsible%open]
====
Conclua as etapas a seguir para criar um SVM junto com vários LIFs para tráfego NFS.

. No ONTAP System Manager, navegue até *VMs de armazenamento* no menu à esquerda e clique em *+ Adicionar* para iniciar.
+
image:vmware-vcf-asa-001.png["Clique em +Adicionar para começar a criar SVM"]

+
{nbsp}

. No assistente *Adicionar VM de armazenamento*, forneça um *Nome* para a SVM, selecione o *Espaço IP* e, em seguida, em *Protocolo de acesso*, clique na guia *SMB/CIFS, NFS, S3* e marque a caixa para *Habilitar NFS*.
+
image:vmware-vcf-aff-035.png["Assistente para adicionar VM de armazenamento - habilitar NFS"]

+

TIP: Não é necessário marcar o botão *Permitir acesso do cliente NFS* aqui, pois o Ontap Tools para VMware vSphere será usado para automatizar o processo de implantação do armazenamento de dados.  Isso inclui fornecer acesso de cliente para os hosts ESXi.  &#160;

. Na seção *Interface de rede*, preencha o *endereço IP*, a *máscara de sub-rede* e o *domínio e porta de transmissão* para o primeiro LIF.  Para LIFs subsequentes, a caixa de seleção pode ser marcada para usar configurações comuns em todos os LIFs restantes ou usar configurações separadas.
+
image:vmware-vcf-aff-036.png["Preencha as informações de rede para LIFs"]

+
{nbsp}

. Escolha se deseja habilitar a conta de administração da VM de armazenamento (para ambientes multilocação) e clique em *Salvar* para criar a SVM.
+
image:vmware-vcf-asa-004.png["Habilitar conta SVM e finalizar"]



====


==== Configurar rede para NFS em hosts ESXi

As etapas a seguir são executadas no cluster do VI Workload Domain usando o cliente vSphere.  Neste caso, o vCenter Single Sign-On está sendo usado para que o cliente vSphere seja comum em todos os domínios de gerenciamento e carga de trabalho.

.Crie um grupo de portas distribuídas para tráfego NFS
[%collapsible%open]
====
Conclua o seguinte para criar um novo grupo de portas distribuídas para a rede transportar tráfego NFS:

. No cliente vSphere, navegue até *Inventário > Rede* para o domínio de carga de trabalho.  Navegue até o Distributed Switch existente e escolha a ação para criar *Novo Grupo de Portas Distribuídas...*.
+
image:vmware-vcf-asa-022.png["Escolha criar um novo grupo de portas"]

+
{nbsp}

. No assistente *Novo grupo de portas distribuídas*, preencha um nome para o novo grupo de portas e clique em *Avançar* para continuar.
. Na página *Configurar configurações* preencha todas as configurações.  Se VLANs estiverem sendo usadas, certifique-se de fornecer o ID de VLAN correto. Clique em *Avançar* para continuar.
+
image:vmware-vcf-asa-023.png["Preencha o ID da VLAN"]

+
{nbsp}

. Na página *Pronto para concluir*, revise as alterações e clique em *Concluir* para criar o novo grupo de portas distribuídas.
. Depois que o grupo de portas for criado, navegue até ele e selecione a ação *Editar configurações...*.
+
image:vmware-vcf-aff-037.png["DPG - editar configurações"]

+
{nbsp}

. Na página *Grupo de portas distribuídas - Editar configurações*, navegue até *Agrupamento e failover* no menu à esquerda.  Habilite o agrupamento para que os Uplinks sejam usados para tráfego NFS, garantindo que eles estejam juntos na área *Uplinks ativos*.  Mova todos os uplinks não utilizados para *Uplinks não utilizados*.
+
image:vmware-vcf-aff-038.png["DPG - uplinks de equipe"]

+
{nbsp}

. Repita esse processo para cada host ESXi no cluster.


====
.Crie um adaptador VMkernel em cada host ESXi
[%collapsible%open]
====
Repita esse processo em cada host ESXi no domínio de carga de trabalho.

. No cliente vSphere, navegue até um dos hosts ESXi no inventário do domínio de carga de trabalho.  Na aba *Configurar* selecione *Adaptadores VMkernel* e clique em *Adicionar Rede...* para iniciar.
+
image:vmware-vcf-asa-030.png["Iniciar assistente de adição de rede"]

+
{nbsp}

. Na janela *Selecionar tipo de conexão*, escolha *Adaptador de rede VMkernel* e clique em *Avançar* para continuar.
+
image:vmware-vcf-asa-008.png["Escolha o adaptador de rede VMkernel"]

+
{nbsp}

. Na página *Selecionar dispositivo de destino*, escolha um dos grupos de portas distribuídas para NFS que foi criado anteriormente.
+
image:vmware-vcf-aff-039.png["Escolha o grupo de portas de destino"]

+
{nbsp}

. Na página *Propriedades da porta*, mantenha os padrões (sem serviços habilitados) e clique em *Avançar* para continuar.
. Na página *Configurações IPv4*, preencha o *endereço IP*, a *máscara de sub-rede* e forneça um novo endereço IP do gateway (somente se necessário). Clique em *Avançar* para continuar.
+
image:vmware-vcf-aff-040.png["Configurações IPv4 do VMkernel"]

+
{nbsp}

. Revise suas seleções na página *Pronto para concluir* e clique em *Concluir* para criar o adaptador VMkernel.
+
image:vmware-vcf-aff-041.png["Revisar as seleções do VMkernel"]



====


=== Implantar e usar ferramentas ONTAP para configurar o armazenamento

As etapas a seguir são executadas no cluster de domínio de gerenciamento do VCF usando o cliente vSphere e envolvem a implantação do OTV, a criação de um armazenamento de dados NFS do vVols e a migração de VMs de gerenciamento para o novo armazenamento de dados.

Para domínios de carga de trabalho do VI, o OTV é instalado no VCF Management Cluster, mas registrado no vCenter associado ao domínio de carga de trabalho do VI.

Para obter informações adicionais sobre a implantação e o uso do ONTAP Tools em um ambiente vCenter múltiplo, consultelink:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/configure/concept_requirements_for_registering_vsc_in_multiple_vcenter_servers_environment.html["Requisitos para registrar ferramentas ONTAP em vários ambientes vCenter Servers"] .

.Implantar ONTAP tools for VMware vSphere
[%collapsible%open]
====
As ONTAP tools for VMware vSphere (OTV) são implantadas como um dispositivo de VM e fornecem uma interface de usuário do vCenter integrada para gerenciar o armazenamento ONTAP .

Conclua o seguinte para implantar ONTAP tools for VMware vSphere:

. Obtenha a imagem OVA das ferramentas ONTAP dolink:https://mysupport.netapp.com/site/products/all/details/otv/downloads-tab["Site de suporte da NetApp"] e baixe para uma pasta local.
. Efetue login no dispositivo vCenter para o domínio de gerenciamento do VCF.
. Na interface do dispositivo vCenter, clique com o botão direito do mouse no cluster de gerenciamento e selecione *Implantar modelo OVF…*
+
image:vmware-vcf-aff-021.png["Implantar modelo OVF..."]

+
{nbsp}

. No assistente *Implantar modelo OVF*, clique no botão de opção *Arquivo local* e selecione o arquivo OVA das ferramentas ONTAP baixado na etapa anterior.
+
image:vmware-vcf-aff-022.png["Selecione o arquivo OVA"]

+
{nbsp}

. Para as etapas 2 a 5 do assistente, selecione um nome e uma pasta para a VM, selecione o recurso de computação, revise os detalhes e aceite o contrato de licença.
. Para o local de armazenamento dos arquivos de configuração e de disco, selecione o armazenamento de dados vSAN do cluster de domínio de gerenciamento do VCF.
+
image:vmware-vcf-aff-023.png["Selecione o arquivo OVA"]

+
{nbsp}

. Na página Selecionar rede, selecione a rede usada para o tráfego de gerenciamento.
+
image:vmware-vcf-aff-024.png["Selecione a rede"]

+
{nbsp}

. Na página Personalizar modelo, preencha todas as informações necessárias:
+
** Senha a ser usada para acesso administrativo ao OTV.
** Endereço IP do servidor NTP.
** Senha da conta de manutenção do OTV.
** Senha do banco de dados OTV Derby.
** Não marque a caixa para *Ativar VMware Cloud Foundation (VCF)*.  O modo VCF não é necessário para implantar armazenamento suplementar.
** FQDN ou endereço IP do dispositivo vCenter para o *Domínio de Carga de Trabalho VI*
** Credenciais para o dispositivo vCenter do *Domínio de Carga de Trabalho VI*
** Forneça os campos de propriedades de rede necessários.
+
Clique em *Avançar* para continuar.

+
image:vmware-vcf-aff-025.png["Personalize o modelo OTV 1"]

+
image:vmware-vcf-asa-035.png["Personalize o modelo OTV 2"]

+
{nbsp}



. Revise todas as informações na página Pronto para concluir e clique em Concluir para começar a implantar o dispositivo OTV.


====
.Adicione um sistema de armazenamento ao ONTAP Tools.
[%collapsible%open]
====
. Acesse o NetApp ONTAP Tools selecionando-o no menu principal no cliente vSphere.
+
image:vmware-asa-006.png["Ferramentas NetApp ONTAP"]

+
{nbsp}

. No menu suspenso *INSTÂNCIA* na interface da ferramenta ONTAP , selecione a instância do OTV associada ao domínio de carga de trabalho a ser gerenciado.
+
image:vmware-vcf-asa-036.png["Escolha a instância OTV"]

+
{nbsp}

. No ONTAP Tools, selecione *Sistemas de armazenamento* no menu à esquerda e pressione *Adicionar*.
+
image:vmware-vcf-asa-037.png["Adicionar sistema de armazenamento"]

+
{nbsp}

. Preencha o endereço IP, as credenciais do sistema de armazenamento e o número da porta.  Clique em *Adicionar* para iniciar o processo de descoberta.
+
image:vmware-vcf-asa-038.png["Fornecer credenciais do sistema de armazenamento"]



====
.Crie um armazenamento de dados NFS no ONTAP Tools
[%collapsible%open]
====
Conclua as etapas a seguir para implantar um armazenamento de dados ONTAP , em execução no NFS, usando o ONTAP Tools.

. No ONTAP Tools, selecione *Visão geral* e na aba *Introdução* clique em *Provisionamento* para iniciar o assistente.
+
image:vmware-vcf-asa-041.png["Provisionar armazenamento de dados"]

+
{nbsp}

. Na página *Geral* do assistente Novo armazenamento de dados, selecione o destino do datacenter ou cluster do vSphere.  Selecione *NFS* como o tipo de armazenamento de dados, preencha um nome para o armazenamento de dados e selecione o protocolo.  Escolha se deseja usar volumes FlexGroup e se deseja usar um arquivo de capacidade de armazenamento para provisionamento. Clique em *Avançar* para continuar.
+
Observação: selecionar *Distribuir dados do armazenamento de dados pelo cluster* criará o volume subjacente como um volume FlexGroup , o que impede o uso de Perfis de Capacidade de Armazenamento.  Consulte https://docs.netapp.com/us-en/ontap/flexgroup/supported-unsupported-config-concept.html["Configurações suportadas e não suportadas para volumes FlexGroup"] para obter mais informações sobre o uso dos volumes FlexGroup .

+
image:vmware-vcf-aff-042.png["Página geral"]

+
{nbsp}

. Na página *Sistema de armazenamento*, selecione um perfil de capacidade de armazenamento, o sistema de armazenamento e o SVM. Clique em *Avançar* para continuar.
+
image:vmware-vcf-aff-043.png["Sistema de armazenamento"]

+
{nbsp}

. Na página *Atributos de armazenamento*, selecione o agregado a ser usado e clique em *Avançar* para continuar.
+
image:vmware-vcf-aff-044.png["Atributos de armazenamento"]

+
{nbsp}

. Por fim, revise o *Resumo* e clique em Concluir para começar a criar o armazenamento de dados NFS.
+
image:vmware-vcf-aff-045.png["Resumo da revisão e conclusão"]



====
.Crie um armazenamento de dados vVols no ONTAP Tools
[%collapsible%open]
====
Para criar um armazenamento de dados vVols no ONTAP Tools, conclua as seguintes etapas:

. No ONTAP Tools, selecione *Visão geral* e na aba *Introdução* clique em *Provisionamento* para iniciar o assistente.
+
image:vmware-vcf-asa-041.png["Provisionar armazenamento de dados"]

. Na página *Geral* do assistente Novo armazenamento de dados, selecione o destino do datacenter ou cluster do vSphere.  Selecione * vVols* como o tipo de armazenamento de dados, preencha um nome para o armazenamento de dados e selecione *NFS* como o protocolo. Clique em *Avançar* para continuar.
+
image:vmware-vcf-aff-046.png["Página geral"]

. Na página *Sistema de armazenamento*, selecione um perfil de capacidade de armazenamento, o sistema de armazenamento e o SVM. Clique em *Avançar* para continuar.
+
image:vmware-vcf-aff-043.png["Sistema de armazenamento"]

. Na página *Atributos de armazenamento*, selecione para criar um novo volume para o armazenamento de dados e preencha os atributos de armazenamento do volume a ser criado.  Clique em *Adicionar* para criar o volume e depois em *Avançar* para continuar.
+
image:vmware-vcf-aff-047.png["Atributos de armazenamento"]

+
image:vmware-vcf-aff-048.png["Atributos de armazenamento - Próximo"]

. Por fim, revise o *Resumo* e clique em *Concluir* para iniciar o processo de criação do armazenamento de dados vVol.
+
image:vmware-vcf-aff-049.png["Página de resumo"]



====


== Informações adicionais

Para obter informações sobre como configurar sistemas de armazenamento ONTAP , consulte olink:https://docs.netapp.com/us-en/ontap["Documentação do ONTAP 9"] centro.

Para obter informações sobre como configurar o VCF, consultelink:https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["Documentação do VMware Cloud Foundation"] .
