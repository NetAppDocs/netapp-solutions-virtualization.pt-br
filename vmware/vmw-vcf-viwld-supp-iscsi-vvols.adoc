---
sidebar: sidebar 
permalink: vmware/vmw-vcf-viwld-supp-iscsi-vvols.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, vvol, vvols, array, ontap tools, otv, sddc, iscsi 
summary:  
---
= Adicione vVols como armazenamento suplementar aos domínios de carga de trabalho VI usando ONTAP tools for VMware vSphere
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Neste caso de uso, descrevemos o procedimento para configurar um armazenamento de dados vVols com iSCSI para armazenamento suplementar em um domínio de carga de trabalho de infraestrutura virtual (VI) do VMware Cloud Foundation (VCF).  Este procedimento resume a configuração da rede iSCSI, a implantação do ONTAP Tools para VMware vSphere e o provisionamento do armazenamento de dados vVols .

*iSCSI* é usado como protocolo de armazenamento para o armazenamento de dados vVols .



== Benefícios do iSCSI

*Alto desempenho:* oferece alto desempenho para fornecer taxas de transferência de dados rápidas e eficientes e baixa latência.  Ideal para aplicativos empresariais exigentes e ambientes virtualizados.

*Facilidade de gerenciamento:* simplifica o gerenciamento de armazenamento usando ferramentas e protocolos familiares baseados em IP.

*Custo-benefício:* utiliza a infraestrutura Ethernet existente, reduzindo a necessidade de hardware especializado e permitindo que as organizações obtenham soluções de armazenamento confiáveis e escaláveis.

Para obter mais informações sobre o uso do iSCSI com sistemas de armazenamento NetApp , consulte https://docs.netapp.com/us-en/ontap/san-admin/san-host-provisioning-concept.html["Provisionamento SAN com iSCSI"] .



== Visão geral do cenário

Este cenário abrange as seguintes etapas de alto nível:

* Crie uma máquina virtual de armazenamento (SVM) com interfaces lógicas (LIFs) para tráfego iSCSI.
* Crie grupos de portas distribuídas para redes iSCSI no domínio de carga de trabalho do VI.
* Crie adaptadores vmkernel para iSCSI nos hosts ESXi para o domínio de carga de trabalho VI.
* Implante o ONTAP Tools no domínio de carga de trabalho do VI.
* Crie um novo armazenamento de dados vVols no domínio de carga de trabalho do VI.




== Pré-requisitos

Este cenário requer os seguintes componentes e configurações:

* Um sistema de armazenamento ONTAP AFF ou ASA com portas de dados físicas em switches Ethernet dedicados ao tráfego de armazenamento.
* A implantação do domínio de gerenciamento do VCF foi concluída e o cliente vSphere está acessível.
* Um domínio de carga de trabalho VI foi implantado anteriormente.


A NetApp recomenda projetos de rede totalmente redundantes para iSCSI.  O diagrama a seguir ilustra um exemplo de configuração redundante, fornecendo tolerância a falhas para sistemas de armazenamento, switches, adaptadores de rede e sistemas host.  Consulte o NetApplink:https://docs.netapp.com/us-en/ontap/san-config/index.html["Referência de configuração SAN"] para obter informações adicionais.

image:vmware-vcf-asa-074.png["Projeto de rede NVMe-tcp"]

{nbsp}

Para multipathing e failover em vários caminhos, a NetApp recomenda ter no mínimo dois LIFs por nó de armazenamento em redes Ethernet separadas para todas as SVMs em configurações iSCSI.

Esta documentação demonstra o processo de criação de um novo SVM e especificação das informações de endereço IP para criar vários LIFs para tráfego iSCSI.  Para adicionar novos LIFs a um SVM existente, consultelink:https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["Criar uma LIF (interface de rede)"] .


TIP: Em situações em que vários adaptadores VMkernel são configurados na mesma rede IP, é recomendável usar a vinculação de porta iSCSI de software nos hosts ESXi para garantir que o balanceamento de carga entre os adaptadores ocorra.  Consulte o artigo da KBlink:https://knowledge.broadcom.com/external/article?legacyId=2038869["Considerações sobre o uso de vinculação de porta iSCSI de software no ESX/ESXi (2038869)"] .

Para obter informações adicionais sobre o uso de datastores VMFS iSCSI com VMware, consultelink:vmw-vmfs-iscsi.html["vSphere VMFS Datastore - backend de armazenamento iSCSI com ONTAP"] .



== Etapas de implantação

Para implantar o ONTAP Tools e usá-lo para criar um armazenamento de dados vVols no domínio de gerenciamento do VCF, conclua as seguintes etapas:



=== Crie SVM e LIFs no sistema de armazenamento ONTAP

A etapa seguinte é executada no ONTAP System Manager.

.Crie a VM de armazenamento e os LIFs
[%collapsible%open]
====
Conclua as etapas a seguir para criar um SVM junto com vários LIFs para tráfego iSCSI.

. No ONTAP System Manager, navegue até *VMs de armazenamento* no menu à esquerda e clique em *+ Adicionar* para iniciar.
+
image:vmware-vcf-asa-001.png["Clique em +Adicionar para começar a criar SVM"]

+
{nbsp}

. No assistente *Adicionar VM de armazenamento*, forneça um *Nome* para a SVM, selecione o *Espaço IP* e, em seguida, em *Protocolo de acesso*, clique na guia *iSCSI* e marque a caixa para *Ativar iSCSI*.
+
image:vmware-vcf-asa-002.png["Assistente para adicionar VM de armazenamento - habilitar iSCSI"]

+
{nbsp}

. Na seção *Interface de rede*, preencha o *endereço IP*, a *máscara de sub-rede* e o *domínio e porta de transmissão* para o primeiro LIF.  Para LIFs subsequentes, a caixa de seleção pode ser marcada para usar configurações comuns em todos os LIFs restantes ou usar configurações separadas.
+

NOTE: Para multipathing e failover em vários caminhos, a NetApp recomenda ter no mínimo dois LIFs por nó de armazenamento em redes Ethernet separadas para todas as SVMs em configurações iSCSI.

+
image:vmware-vcf-asa-003.png["Preencha as informações de rede para LIFs"]

+
{nbsp}

. Escolha se deseja habilitar a conta de administração da VM de armazenamento (para ambientes multilocação) e clique em *Salvar* para criar a SVM.
+
image:vmware-vcf-asa-004.png["Habilitar conta SVM e finalizar"]



====


=== Configurar rede para iSCSI em hosts ESXi

As etapas a seguir são executadas no cluster do VI Workload Domain usando o cliente vSphere.  Neste caso, o vCenter Single Sign-On está sendo usado para que o cliente vSphere seja comum em todos os domínios de gerenciamento e carga de trabalho.

.Criar grupos de portas distribuídas para tráfego iSCSI
[%collapsible%open]
====
Conclua o seguinte para criar um novo grupo de portas distribuídas para cada rede iSCSI:

. No cliente vSphere, navegue até *Inventário > Rede* para o domínio de carga de trabalho.  Navegue até o Distributed Switch existente e escolha a ação para criar *Novo Grupo de Portas Distribuídas...*.
+
image:vmware-vcf-asa-022.png["Escolha criar um novo grupo de portas"]

+
{nbsp}

. No assistente *Novo grupo de portas distribuídas*, preencha um nome para o novo grupo de portas e clique em *Avançar* para continuar.
. Na página *Configurar configurações* preencha todas as configurações.  Se VLANs estiverem sendo usadas, certifique-se de fornecer o ID de VLAN correto. Clique em *Avançar* para continuar.
+
image:vmware-vcf-asa-023.png["Preencha o ID da VLAN"]

+
{nbsp}

. Na página *Pronto para concluir*, revise as alterações e clique em *Concluir* para criar o novo grupo de portas distribuídas.
. Repita esse processo para criar um grupo de portas distribuídas para a segunda rede iSCSI que está sendo usada e certifique-se de ter inserido o *ID de VLAN* correto.
. Depois que ambos os grupos de portas forem criados, navegue até o primeiro grupo de portas e selecione a ação *Editar configurações...*.
+
image:vmware-vcf-asa-024.png["DPG - editar configurações"]

+
{nbsp}

. Na página *Grupo de portas distribuídas - Editar configurações*, navegue até *Agrupamento e failover* no menu à esquerda e clique em *uplink2* para movê-lo para *Uplinks não utilizados*.
+
image:vmware-vcf-asa-025.png["mover uplink2 para não utilizado"]

. Repita esta etapa para o segundo grupo de portas iSCSI.  Entretanto, desta vez mova *uplink1* para *Uplinks não utilizados*.
+
image:vmware-vcf-asa-026.png["mover uplink1 para não utilizado"]



====
.Crie adaptadores VMkernel em cada host ESXi
[%collapsible%open]
====
Repita esse processo em cada host ESXi no domínio de carga de trabalho.

. No cliente vSphere, navegue até um dos hosts ESXi no inventário do domínio de carga de trabalho.  Na aba *Configurar* selecione *Adaptadores VMkernel* e clique em *Adicionar Rede...* para iniciar.
+
image:vmware-vcf-asa-030.png["Iniciar assistente de adição de rede"]

+
{nbsp}

. Na janela *Selecionar tipo de conexão*, escolha *Adaptador de rede VMkernel* e clique em *Avançar* para continuar.
+
image:vmware-vcf-asa-008.png["Escolha o adaptador de rede VMkernel"]

+
{nbsp}

. Na página *Selecionar dispositivo de destino*, escolha um dos grupos de portas distribuídas para iSCSI que foi criado anteriormente.
+
image:vmware-vcf-asa-031.png["Escolha o grupo de portas de destino"]

+
{nbsp}

. Na página *Propriedades da porta*, mantenha os padrões e clique em *Avançar* para continuar.
+
image:vmware-vcf-asa-032.png["Propriedades da porta VMkernel"]

+
{nbsp}

. Na página *Configurações IPv4*, preencha o *endereço IP*, a *máscara de sub-rede* e forneça um novo endereço IP do gateway (somente se necessário). Clique em *Avançar* para continuar.
+
image:vmware-vcf-asa-033.png["Configurações IPv4 do VMkernel"]

+
{nbsp}

. Revise suas seleções na página *Pronto para concluir* e clique em *Concluir* para criar o adaptador VMkernel.
+
image:vmware-vcf-asa-034.png["Revisar as seleções do VMkernel"]

+
{nbsp}

. Repita esse processo para criar um adaptador VMkernel para a segunda rede iSCSI.


====


=== Implantar e usar ferramentas ONTAP para configurar o armazenamento

As etapas a seguir são executadas no cluster de domínio de gerenciamento do VCF usando o cliente vSphere e envolvem a implantação do ONTAP Tools, a criação de um armazenamento de dados iSCSI vVols e a migração de VMs de gerenciamento para o novo armazenamento de dados.

Para domínios de carga de trabalho do VI, o ONTAP Tools é instalado no VCF Management Cluster, mas registrado no vCenter associado ao domínio de carga de trabalho do VI.

Para obter informações adicionais sobre a implantação e o uso do ONTAP Tools em um ambiente vCenter múltiplo, consultelink:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/configure/concept_requirements_for_registering_vsc_in_multiple_vcenter_servers_environment.html["Requisitos para registrar ferramentas ONTAP em vários ambientes vCenter Servers"] .

.Implantar ONTAP tools for VMware vSphere
[%collapsible%open]
====
As ONTAP tools for VMware vSphere são implantadas como um dispositivo de VM e fornecem uma interface de usuário do vCenter integrada para gerenciar o armazenamento ONTAP .

Conclua o seguinte para implantar ONTAP tools for VMware vSphere:

. Obtenha a imagem OVA das ferramentas ONTAP dolink:https://mysupport.netapp.com/site/products/all/details/otv/downloads-tab["Site de suporte da NetApp"] e baixe para uma pasta local.
. Efetue login no dispositivo vCenter para o domínio de gerenciamento do VCF.
. Na interface do dispositivo vCenter, clique com o botão direito do mouse no cluster de gerenciamento e selecione *Implantar modelo OVF…*
+
image:vmware-vcf-aff-021.png["Implantar modelo OVF..."]

+
{nbsp}

. No assistente *Implantar modelo OVF*, clique no botão de opção *Arquivo local* e selecione o arquivo OVA das ferramentas ONTAP baixado na etapa anterior.
+
image:vmware-vcf-aff-022.png["Selecione o arquivo OVA"]

+
{nbsp}

. Para as etapas 2 a 5 do assistente, selecione um nome e uma pasta para a VM, selecione o recurso de computação, revise os detalhes e aceite o contrato de licença.
. Para o local de armazenamento dos arquivos de configuração e de disco, selecione o armazenamento de dados vSAN do cluster de domínio de gerenciamento do VCF.
+
image:vmware-vcf-aff-023.png["Selecione o arquivo OVA"]

+
{nbsp}

. Na página Selecionar rede, selecione a rede usada para o tráfego de gerenciamento.
+
image:vmware-vcf-aff-024.png["Selecione a rede"]

+
{nbsp}

. Na página Personalizar modelo, preencha todas as informações necessárias:
+
** Senha a ser usada para acesso administrativo ao ONTAP Tools.
** Endereço IP do servidor NTP.
** Senha da conta de manutenção do ONTAP Tools.
** Senha do banco de dados ONTAP Tools Derby.
** Não marque a caixa para *Ativar VMware Cloud Foundation (VCF)*.  O modo VCF não é necessário para implantar armazenamento suplementar.
** FQDN ou endereço IP do dispositivo vCenter para o *Domínio de Carga de Trabalho VI*
** Credenciais para o dispositivo vCenter do *Domínio de Carga de Trabalho VI*
** Forneça os campos de propriedades de rede necessários.
+
Clique em *Avançar* para continuar.

+
image:vmware-vcf-aff-025.png["Personalize o modelo OTV 1"]

+
image:vmware-vcf-asa-035.png["Personalize o modelo OTV 2"]

+
{nbsp}



. Revise todas as informações na página Pronto para concluir e clique em Concluir para começar a implantar o dispositivo ONTAP Tools.


====
.Adicione um sistema de armazenamento ao ONTAP Tools.
[%collapsible%open]
====
. Acesse o NetApp ONTAP Tools selecionando-o no menu principal no cliente vSphere.
+
image:vmware-asa-006.png["Ferramentas NetApp ONTAP"]

+
{nbsp}

. No menu suspenso *INSTÂNCIA* na interface da ferramenta ONTAP , selecione a instância da ferramenta ONTAP associada ao domínio de carga de trabalho a ser gerenciado.
+
image:vmware-vcf-asa-036.png["Escolha a instância OTV"]

+
{nbsp}

. No ONTAP Tools, selecione *Sistemas de armazenamento* no menu à esquerda e pressione *Adicionar*.
+
image:vmware-vcf-asa-037.png["Adicionar sistema de armazenamento"]

+
{nbsp}

. Preencha o endereço IP, as credenciais do sistema de armazenamento e o número da porta.  Clique em *Adicionar* para iniciar o processo de descoberta.
+

NOTE: O vVol requer credenciais de cluster ONTAP em vez de credenciais SVM.  Para mais informações consulte https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/configure/task_add_storage_systems.html["Adicionar sistemas de armazenamento"] Na documentação das ferramentas ONTAP .

+
image:vmware-vcf-asa-038.png["Fornecer credenciais do sistema de armazenamento"]



====
.Crie um perfil de capacidade de armazenamento no ONTAP Tools
[%collapsible%open]
====
Os perfis de capacidade de armazenamento descrevem os recursos fornecidos por um conjunto de armazenamento ou sistema de armazenamento.  Elas incluem definições de qualidade de serviço e são usadas para selecionar sistemas de armazenamento que atendem aos parâmetros definidos no perfil.  Um dos perfis fornecidos pode ser usado ou novos podem ser criados.

Para criar um perfil de capacidade de armazenamento no ONTAP Tools, conclua as seguintes etapas:

. No ONTAP Tools, selecione *Perfil de capacidade de armazenamento* no menu à esquerda e pressione *Criar*.
+
image:vmware-vcf-asa-039.png["Perfil de capacidade de armazenamento"]

. No assistente *Criar perfil de capacidade de armazenamento*, forneça um nome e uma descrição do perfil e clique em *Avançar*.
+
image:vmware-asa-010.png["Adicionar nome para SCP"]

. Selecione o tipo de plataforma e especifique que o sistema de armazenamento deve ser um All-Flash SAN Array definido como *Assimétrico* como falso.
+
image:vmware-asa-011.png["Plataforma para SCP"]

. Em seguida, selecione a escolha do protocolo ou *Qualquer* para permitir todos os protocolos possíveis. Clique em *Avançar* para continuar.
+
image:vmware-asa-012.png["Protocolo para SCP"]

. A página *desempenho* permite definir a qualidade do serviço na forma de IOPs mínimos e máximos permitidos.
+
image:vmware-asa-013.png["QoS para SCP"]

. Preencha a página *atributos de armazenamento* selecionando eficiência de armazenamento, reserva de espaço, criptografia e qualquer política de níveis, conforme necessário.
+
image:vmware-asa-014.png["Atributos para SCP"]

. Por fim, revise o resumo e clique em Concluir para criar o perfil.
+
image:vmware-vcf-asa-040.png["Resumo para SCP"]



====
.Crie um armazenamento de dados vVols no ONTAP Tools
[%collapsible%open]
====
Para criar um armazenamento de dados vVols no ONTAP Tools, conclua as seguintes etapas:

. No ONTAP Tools, selecione *Visão geral* e na aba *Introdução* clique em *Provisionamento* para iniciar o assistente.
+
image:vmware-vcf-asa-041.png["Provisionar armazenamento de dados"]

. Na página *Geral* do assistente Novo armazenamento de dados, selecione o destino do datacenter ou cluster do vSphere.  Selecione * vVols* como o tipo de armazenamento de dados, preencha um nome para o armazenamento de dados e selecione *iSCSI* como o protocolo. Clique em *Avançar* para continuar.
+
image:vmware-vcf-asa-042.png["Página geral"]

. Na página *Sistema de armazenamento*, selecione um perfil de capacidade de armazenamento, o sistema de armazenamento e o SVM. Clique em *Avançar* para continuar.
+
image:vmware-vcf-asa-043.png["Sistema de armazenamento"]

. Na página *Atributos de armazenamento*, selecione para criar um novo volume para o armazenamento de dados e preencha os atributos de armazenamento do volume a ser criado.  Clique em *Adicionar* para criar o volume e depois em *Avançar* para continuar.
+
image:vmware-vcf-asa-044.png["Atributos de armazenamento"]

. Por fim, revise o resumo e clique em *Concluir* para iniciar o processo de criação do armazenamento de dados vVol.
+
image:vmware-vcf-asa-045.png["Página de resumo"]



====


== Informações adicionais

Para obter informações sobre como configurar sistemas de armazenamento ONTAP , consulte olink:https://docs.netapp.com/us-en/ontap["Documentação do ONTAP 9"] centro.

Para obter informações sobre como configurar o VCF, consultelink:https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["Documentação do VMware Cloud Foundation"] .
