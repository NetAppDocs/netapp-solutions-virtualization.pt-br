---
sidebar: sidebar 
permalink: vmware/vmw-vcf-dr-bxp-nfs.html 
keywords: netapp, vmware, cloud, foundation, vcf, bluexp, disaster recovery, nfs 
summary: Solução de recuperação de desastres para VCF com BlueXP disaster recovery como serviço. 
---
= Implementando recuperação de desastres com NetApp SnapMirror e BlueXP DRaaS
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Solução de recuperação de desastres VCF para armazenamento de dados NFS com NetApp SnapMirror e BlueXP DRaaS

A replicação em nível de bloco de um site de produção para um site de recuperação de desastres (DR) oferece uma estratégia resiliente e econômica para proteger cargas de trabalho contra interrupções do site e eventos de corrupção de dados, incluindo ataques de ransomware.  A replicação do NetApp SnapMirror permite que domínios de carga de trabalho do VMware VCF 9 em execução em sistemas ONTAP locais, usando armazenamentos de dados NFS ou VMFS, sejam replicados para um sistema ONTAP secundário localizado em um data center de recuperação designado onde o VMware também está implantado.

Esta seção descreve a configuração do BlueXP Disaster Recovery as a Service (DRaaS) para estabelecer DR para máquinas virtuais VMware locais.

A configuração inclui:

* Criando uma conta BlueXP e implantando um conector BlueXP .
* Adicionar matrizes ONTAP à tela BlueXP para facilitar a comunicação entre o VMware vCenter e o armazenamento ONTAP .
* Configurando replicação entre sites usando SnapMirror.
* Configurar e testar um plano de recuperação para validar a prontidão para failover.


O serviço de BlueXP disaster recovery , integrado ao console NetApp BlueXP , permite que as organizações descubram facilmente seus sistemas de armazenamento VMware vCenters e ONTAP locais.  Uma vez descobertos, os administradores podem definir agrupamentos de recursos, criar planos de recuperação de desastres, associá-los aos recursos apropriados e iniciar ou testar operações de failover e failback.  O NetApp SnapMirror fornece replicação eficiente em nível de bloco, garantindo que o site de DR permaneça sincronizado com o ambiente de produção por meio de atualizações incrementais.  Isso permite um Objetivo de Ponto de Recuperação (RPO) de apenas cinco minutos.

O BlueXP DRaaS também oferece suporte a testes de recuperação de desastres sem interrupções.  Aproveitando a tecnologia FlexClone da ONTAP, ele cria cópias temporárias e com eficiência de espaço do armazenamento de dados NFS a partir do Snapshot replicado mais recente, sem impactar as cargas de trabalho de produção ou incorrer em custos adicionais de armazenamento.  Após o teste, o ambiente pode ser facilmente desmontado, preservando a integridade dos dados replicados.

No caso de um failover real, o BlueXP orquestra o processo de recuperação, trazendo automaticamente máquinas virtuais protegidas para o site de DR designado com intervenção mínima do usuário.  Quando o site principal é restaurado, o serviço inverte o relacionamento do SnapMirror e replica quaisquer alterações de volta ao site original, permitindo um failback suave e controlado.

Todos esses recursos são fornecidos a um custo significativamente menor em comparação às soluções tradicionais de recuperação de desastres.

image::vmw-vcf-dr-bxp-nfs-001.png[Diagrama de Arquitetura DR com BlueXP]



== Começando

Para começar a BlueXP disaster recovery, use o console do BlueXP e acesse o serviço.

. Faça login no BlueXP.
. Na navegação à esquerda do BlueXP , selecione Proteção > Recuperação de desastres.
. O painel de BlueXP disaster recovery é exibido.
+
image::vmw-vcf-dr-bxp-nfs-002.png[Painel BlueXP DR]



Antes de configurar o plano de recuperação de desastres, certifique-se do seguintelink:https://docs.netapp.com/us-en/bluexp-disaster-recovery/get-started/dr-prerequisites.html["pré-requisitos"] são atendidas:

* O BlueXP Connector é configurado no NetApp BlueXP.
* A instância do conector BlueXP tem conectividade com o domínio de carga de trabalho de origem e destino vCenter e sistemas de armazenamento.
* Cluster NetApp Data ONTAP para fornecer armazenamento de dados NFS ou VMFS.
* Os sistemas de armazenamento NetApp locais que hospedam datastores NFS ou VMFS para VMware são adicionados no BlueXP.
* A resolução de DNS deve estar em vigor ao usar nomes DNS. Caso contrário, use endereços IP para o vCenter.
* A replicação do SnapMirror é configurada para os volumes de armazenamento de dados baseados em NFS ou VMFS designados.
* Certifique-se de que o ambiente tenha versões compatíveis dos servidores vCenter Server e ESXi.


Depois que a conectividade for estabelecida entre os sites de origem e destino, prossiga com as etapas de configuração, que devem levar alguns cliques e cerca de 3 a 5 minutos.

Observação: a NetApp recomenda implantar o conector BlueXP no site de destino ou em um terceiro site, para que o conector BlueXP possa se comunicar pela rede com os recursos de origem e destino.

Nesta demonstração, os domínios de carga de trabalho são configurados com armazenamento ONTAP NFS.  As etapas em termos de fluxo de trabalho permanecem as mesmas para armazenamentos de dados baseados em VMFS.

image::vmw-vcf-dr-bxp-nfs-003.png[Painel de DR detalhado do BlueXP]



== Configuração de BlueXP disaster recovery

O primeiro passo na preparação para a recuperação de desastres é descobrir e adicionar os recursos de armazenamento e vCenter de origem à BlueXP disaster recovery.

Abra o console do BlueXP e selecione Proteção > Recuperação de desastres na navegação à esquerda.  Selecione Descobrir servidores vCenter ou use o menu superior, selecione Sites > Adicionar > Adicionar vCenter.

Adicione as seguintes plataformas:

* Domínio de carga de trabalho de origem vCenter
* Domínio de carga de trabalho de destino vCenter.


Depois que os vCenters são adicionados, a descoberta automatizada é acionada.



== Configurando a replicação de armazenamento entre a matriz do site de origem e a matriz do site de destino

O SnapMirror fornece replicação de dados em um ambiente NetApp . Construída com a tecnologia NetApp Snapshot®, a replicação SnapMirror é extremamente eficiente porque replica apenas os blocos que foram alterados ou adicionados desde a atualização anterior.  O SnapMirror é facilmente configurado usando o NetApp OnCommand System Manager ou o ONTAP CLI. O BlueXP DRaaS também cria o relacionamento SnapMirror , desde que o cluster e o peering SVM sejam configurados previamente.

Para casos em que o armazenamento primário não é completamente perdido, o SnapMirror fornece um meio eficiente de ressincronizar os sites primário e de DR. O SnapMirror pode ressincronizar os dois sites, transferindo apenas dados alterados ou novos de volta para o site principal a partir do site de DR, simplesmente invertendo os relacionamentos do SnapMirror . Isso significa que os planos de replicação no BlueXP DRaaS podem ser ressincronizados em qualquer direção após um failover sem recopiar o volume inteiro. Se um relacionamento for ressincronizado na direção reversa, somente os novos dados que foram gravados desde a última sincronização bem-sucedida da cópia do Snapshot serão enviados de volta ao destino.


NOTE: Se o relacionamento do SnapMirror já estiver configurado para o volume via CLI ou System Manager, o BlueXP DRaaS assume o relacionamento e continua com o restante das operações de fluxo de trabalho.



== Como configurá-lo para recuperação de desastres do VMware

O processo para criar a replicação do SnapMirror permanece o mesmo para qualquer aplicativo. O processo pode ser manual ou automatizado. A maneira mais fácil é aproveitar o BlueXP DRaaS, que automatizará o mesmo, desde que os dois critérios a seguir sejam atendidos:

* Os clusters de origem e destino têm um relacionamento de pares.
* O SVM de origem e o SVM de destino têm um relacionamento de mesmo nível.


image::vmw-vcf-dr-bxp-nfs-004.png[Mapeamento de recursos BlueXP]

O BlueXP também fornece uma opção alternativa para configurar a replicação do SnapMirror usando o simples recurso de arrastar e soltar do sistema ONTAP de origem no ambiente para o destino para acionar o assistente que orienta o restante do processo.



== O que a BlueXP disaster recovery pode fazer por você?

Depois que os sites de origem e destino são adicionados, a BlueXP disaster recovery executa a descoberta profunda automática e exibe as VMs junto com os metadados associados. A BlueXP disaster recovery também detecta automaticamente as redes e os grupos de portas usados pelas VMs e os preenche.

image::vmw-vcf-dr-bxp-nfs-005.png[Sites BlueXP]

Após os sites serem adicionados, configure o plano de replicação selecionando as plataformas vCenter de origem e destino no menu suspenso e escolha os grupos de recursos a serem incluídos no plano, juntamente com o agrupamento de como os aplicativos devem ser restaurados e ligados, além do mapeamento de clusters e redes. Para definir o plano de recuperação, navegue até a guia *Plano de Replicação* e clique em *Adicionar Plano*.

Nesta etapa, as VMs podem ser agrupadas em grupos de recursos. Os grupos de recursos de BlueXP disaster recovery permitem que você agrupe um conjunto de VMs dependentes em grupos lógicos que contêm suas ordens de inicialização e atrasos de inicialização que podem ser executados na recuperação.  O grupo de recursos também pode ser criado usando a guia Grupo de recursos.

Primeiro, selecione o vCenter de origem e depois selecione o vCenter de destino.

image::vmw-vcf-dr-bxp-nfs-006.png[BlueXP alvo vCenter]

O próximo passo é selecionar grupos de recursos existentes. Se nenhum grupo de recursos for criado, o assistente ajudará a agrupar as máquinas virtuais necessárias (basicamente, criar grupos de recursos funcionais) com base nos objetivos de recuperação. Isso também ajuda a definir a sequência de operação de como as máquinas virtuais do aplicativo devem ser restauradas.

image::vmw-vcf-dr-bxp-nfs-007.png[BlueXP seleciona VMs para proteger]


NOTE: O grupo de recursos permite definir a ordem de inicialização usando a funcionalidade de arrastar e soltar. Ele pode ser usado para modificar facilmente a ordem em que as VMs serão ligadas durante o processo de recuperação.

Depois que os grupos de recursos são criados por meio do plano de replicação, a próxima etapa é selecionar o blueprint ou um mapeamento para recuperar máquinas virtuais e aplicativos em caso de desastre. Nesta etapa, especifique como os recursos do ambiente de origem são mapeados para o destino.  Isso inclui recursos de computação, redes virtuais, personalização de IP, pré e pós-scripts, atrasos de inicialização, consistência de aplicativos e assim por diante. Para obter informações detalhadas, consultelink:https://docs.netapp.com/us-en/bluexp-disaster-recovery/use/drplan-create.html#map-source-resources-to-the-target["Crie um plano de replicação"] . Conforme mencionado nos pré-requisitos, a replicação do SnapMirror pode ser configurada antecipadamente ou o DRaaS pode configurá-la usando o RPO e a contagem de retenção especificados durante a criação do plano de replicação.

Observação: por padrão, os mesmos parâmetros de mapeamento são usados para operações de teste e failover.  Para definir mapeamentos diferentes para o ambiente de teste, selecione a opção Mapeamento de teste após desmarcar a caixa de seleção “Usar os mesmos mapeamentos para failover e mapeamentos de teste”. Quando o mapeamento de recursos estiver concluído, clique em Avançar.

image::vmw-vcf-dr-bxp-nfs-008.png[Mapeamento de recursos BlueXP]

Uma vez concluído, revise os mapeamentos criados e clique em Adicionar plano.

image::vmw-vcf-dr-bxp-nfs-009.png[Análise do mapeamento de recursos do BlueXP]


NOTE: VMs de diferentes volumes e SVMs podem ser incluídas em um plano de replicação. Dependendo do posicionamento da VM (seja no mesmo volume ou em volumes separados dentro da mesma SVM, volumes separados em SVMs diferentes), a BlueXP disaster recovery cria um instantâneo de grupo de consistência.

image::vmw-vcf-dr-bxp-nfs-010.png[Planos de BlueXP replication]

Assim que o plano é criado, uma série de validações são acionadas e a replicação e os agendamentos do SnapMirror são configurados conforme a seleção.

image::vmw-vcf-dr-bxp-nfs-011.png[Monitoramento de tarefas BlueXP]

O BlueXP DRaaS consiste nos seguintes fluxos de trabalho:

* Teste de failover (incluindo simulações automatizadas periódicas)
* Teste de failover de limpeza
* Failover:
+
** Migração planejada (estender o caso de uso para failover único)
** Recuperação de desastres


* Failback


image::vmw-vcf-dr-bxp-nfs-012.png[Ações do plano de BlueXP replication]



== Teste de failover

O failover de teste no BlueXP DRaaS é um procedimento operacional que permite que os administradores do VMware validem totalmente seus planos de recuperação sem interromper seus ambientes de produção.

image::vmw-vcf-dr-bxp-nfs-013.png[Failover de teste do plano de BlueXP replication]

O BlueXP DRaaS incorpora a capacidade de selecionar o snapshot como um recurso opcional na operação de failover de teste. Esse recurso permite que o administrador do VMware verifique se quaisquer alterações feitas recentemente no ambiente são replicadas no site de destino e, portanto, estão presentes durante o teste. Essas mudanças incluem patches para o sistema operacional convidado da VM.

image::vmw-vcf-dr-bxp-nfs-014.png[Confirmação de failover do teste do plano de BlueXP replication]

Quando o administrador do VMware executa uma operação de failover de teste, o BlueXP DRaaS automatiza as seguintes tarefas:

* Acionar relacionamentos do SnapMirror para atualizar o armazenamento no site de destino com quaisquer alterações recentes feitas no site de produção.
* Criação de volumes NetApp FlexClone dos volumes FlexVol no array de armazenamento DR.
* Conectando os datastores nos volumes FlexClone aos hosts ESXi no site de DR.
* Conectando os adaptadores de rede da VM à rede de teste especificada durante o mapeamento.
* Reconfigurando as configurações de rede do sistema operacional convidado da VM, conforme definido para a rede no site de DR.
* Executar quaisquer comandos personalizados que tenham sido armazenados no plano de replicação.
* Ligar as VMs na ordem definida no plano de replicação.


image::vmw-vcf-dr-bxp-nfs-015.png[Resultado de failover do teste do plano de BlueXP replication]



== Operação de teste de failover de limpeza

A operação de teste de failover de limpeza ocorre após a conclusão do teste do plano de replicação e o administrador do VMware responde ao prompt de limpeza.

image::vmw-vcf-dr-bxp-nfs-016.png[Plano de BlueXP replication teste failover limpeza]

Esta ação redefinirá as máquinas virtuais (VMs) e o status do plano de replicação para o estado pronto. Quando o administrador do VMware executa uma operação de recuperação, o BlueXP DRaaS conclui o seguinte processo:

. Ele desliga cada VM recuperada na cópia do FlexClone que foi usada para teste.
. Ele exclui o volume FlexClone que foi usado para apresentar as VMs recuperadas durante o teste.




== Migração planejada e failover

O BlueXP DRaaS tem dois métodos para executar um failover real: migração planejada e failover. O primeiro método, migração planejada, incorpora o desligamento da VM e a sincronização da replicação do armazenamento no processo para recuperar ou mover efetivamente as VMs para o site de destino. A migração planejada requer acesso ao site de origem. O segundo método, failover, é um failover planejado/não planejado no qual as VMs são recuperadas no site de destino a partir do último intervalo de replicação de armazenamento que foi concluído. Dependendo do RPO que foi projetado na solução, alguma perda de dados pode ser esperada no cenário de DR.

image::vmw-vcf-dr-bxp-nfs-017.png[Ação de failover do plano de BlueXP replication]

image::vmw-vcf-dr-bxp-nfs-018.png[Confirmação da ação de failover do plano de BlueXP replication]

Quando o administrador do VMware executa uma operação de failover, o BlueXP DRaaS automatiza as seguintes tarefas:

* Interrompa e faça failover dos relacionamentos do NetApp SnapMirror .
* Conecte os armazenamentos de dados replicados aos hosts ESXi no site de DR.
* Conecte os adaptadores de rede da VM à rede do site de destino apropriada.
* Reconfigure as configurações de rede do sistema operacional convidado da VM, conforme definido para a rede no site de destino.
* Execute quaisquer comandos personalizados (se houver) que tenham sido armazenados no plano de replicação.
* Ligue as VMs na ordem definida no plano de replicação.


image::vmw-vcf-dr-bxp-nfs-019.png[vSphere Client - VMs ligadas]



== Failback

Um failback é um procedimento opcional que restaura a configuração original dos sites de origem e destino após uma recuperação.

image::vmw-vcf-dr-bxp-nfs-020.png[Ação de failback do plano de BlueXP replication]

Os administradores do VMware podem configurar e executar um procedimento de failback quando estiverem prontos para restaurar serviços no site de origem original.


NOTE: O BlueXP DRaaS replica (ressincroniza) quaisquer alterações de volta para a máquina virtual de origem antes de reverter a direção da replicação.

Esse processo começa com um relacionamento que concluiu o failover para um alvo e envolve as seguintes etapas:

* Desligue e cancele o registro das máquinas virtuais e os volumes no site de destino serão desmontados.
+
image::vmw-vcf-dr-bxp-nfs-021.png[vSphere Client - tarefas recentes]

* Interrompa o relacionamento SnapMirror na fonte original para torná-lo de leitura/gravação.
* Ressincronize o relacionamento do SnapMirror para reverter a replicação.
* Monte o volume na origem, ligue e registre as máquinas virtuais de origem.
+
image::vmw-vcf-dr-bxp-nfs-022.png[vSphere Client - VMs ligadas]



Para obter mais detalhes sobre como acessar e configurar o BlueXP DRaaS, consulte olink:https://docs.netapp.com/us-en/bluexp-disaster-recovery/get-started/dr-intro.html["Saiba mais sobre o BlueXP Disaster Recovery para VMware"] .



== Monitoramento e Painel

No BlueXP ou no ONTAP CLI, você pode monitorar o status de integridade da replicação para os volumes de armazenamento de dados apropriados, e o status de um failover ou failover de teste pode ser rastreado por meio do Monitoramento de tarefas.

image::vmw-vcf-dr-bxp-nfs-023.png[Monitoramento de tarefas BlueXP]


NOTE: Se um trabalho estiver em andamento ou na fila e você desejar interrompê-lo, há uma opção para cancelá-lo.

Com o painel de BlueXP disaster recovery , avalie com confiança o status dos sites de recuperação de desastres e dos planos de replicação. Isso permite que os administradores identifiquem rapidamente sites e planos saudáveis, desconectados ou degradados.

image::vmw-vcf-dr-bxp-nfs-024.png[BlueXP atualizou o dr deashboard]

Isso fornece uma solução poderosa para lidar com um plano de recuperação de desastres personalizado e personalizado. O failover pode ser feito como failover planejado ou failover com o clique de um botão quando ocorre um desastre e é tomada a decisão de ativar o site de DR.
